name: CI

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    test:
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest, macos-latest, windows-latest]
                bazel-version: ["7.0.0", "6.5.0"]
                exclude:
                    - os: windows-latest
                      bazel-version: "6.5.0"

        steps:
            - uses: actions/checkout@v6.0.1

            - name: Set up Bazel
              uses: bazel-contrib/setup-bazel@0.15.0
              with:
                  bazelisk-version: "1.27.0"

            - name: Run tests
              run: bazel test //tests/... //examples/...

            - name: Build examples
              run: bazel build //examples/...

    lint:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v6.0.1

            - name: Set up Bun
              uses: oven-sh/setup-bun@v2.0.2
              with:
                  bun-version: latest

            - name: Install Prettier
              run: bun install -g prettier

            - name: Check formatting
              run: bunx prettier --check "**/*.{js,ts,json,yaml,md}"

            - name: Run pre-commit
              uses: pre-commit/action@v3.0.1
